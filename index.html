<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>INTO SLU – AI Query Manager</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --slu-blue:#003DA5; --slu-blue-200:#86A6E7; --slu-gold:#C5A900;
    --ink:#0c2355; --muted:#e9eef9; --bg:#ffffff;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header{background:var(--slu-blue);color:#fff;display:flex;gap:14px;align-items:center;justify-content:space-between;padding:16px 20px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
  .brand{display:flex;gap:12px;align-items:center}
  .brand img{height:56px;width:auto;object-fit:contain}
  .subtitle{opacity:.95;font-size:.92rem}
  main{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--slu-blue);border-radius:14px;box-shadow:0 2px 10px rgba(0,61,165,.08);padding:14px 14px 16px}
  h2{font-size:1.05rem;margin-bottom:8px}
  textarea{width:100%;min-height:100px;border:1px solid var(--muted);border-radius:12px;padding:12px;outline:none}
  textarea:focus{border-color:var(--slu-blue);box-shadow:0 0 0 3px rgba(0,61,165,.14)}
  input,select,button{font:inherit}
  input{border:1px solid var(--muted);border-radius:10px;padding:10px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button.primary{background:var(--slu-gold);border:none;color:#1a1a1a;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.08)}
  .badges{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .chip{display:inline-flex;gap:6px;align-items:center;padding:6px 12px;border-radius:999px;border:1px solid #dfe6ff;background:#f7f9ff;font-size:.83rem}
  .chip.high{border-color:#f2c4c7;background:#fdebec;color:#7e1f25}
  .chip.med {border-color:#ffe8b0;background:#fff7da;color:#624a00}
  .chip.low {border-color:#cddbf2;background:#eef4ff;color:#1b4a8f}
  .list{display:grid;gap:12px;margin-top:10px}
  .row{border:1px solid #e7eefc;border-radius:12px;padding:12px;display:grid;grid-template-columns:1fr auto;gap:8px;background:#fcfdff}
  .row .meta{display:flex;gap:10px;align-items:center;justify-content:flex-end}
  .filterbar{display:flex;gap:10px;flex-wrap:wrap}
  .chart-wrap{position:relative;background:linear-gradient(180deg,#f7f9ff 0%,#eef3ff 100%);border:1px solid #dbe6ff;border-radius:12px;padding:8px;min-height:240px;display:flex;align-items:center;justify-content:center}
  .center-hint{position:absolute;text-align:center;color:#5c6ea8;font-size:.92rem;pointer-events:none}
  .pro-footer{margin-top:10px;background:linear-gradient(90deg,#003DA5 0%,#1C57C9 60%,#86A6E7 100%);color:#fff;padding:14px 10px;text-align:center;font-weight:700;letter-spacing:.2px;box-shadow:0 -2px 10px rgba(0,0,0,.08)}
</style>
</head>
<body>
<header>
  <div class="brand">
    <!-- You can swap the src for your hosted logo if you prefer -->
    <img alt="Saint Louis University" src="https://upload.wikimedia.org/wikipedia/en/7/75/Saint_Louis_University_seal.svg">
    <div>
      <div style="font-weight:800;letter-spacing:.2px">INTO SLU – AI Query Manager</div>
      <div class="subtitle">Priority triage • sentiment • insights</div>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card">
      <h2>New message</h2>
      <textarea id="msg" placeholder="Paste a student question here… e.g., “My I-20 deadline is tomorrow and I can’t find the payment link.”"></textarea>
      <div class="controls">
        <input id="name"  placeholder="Name (optional)"/>
        <input id="email" placeholder="Email (optional)"/>
        <!-- Critical fix: type=button + inline handler -->
        <button id="analyzeBtn" class="primary" type="button" onclick="handleAnalyze()">Analyze &amp; add to inbox</button>
      </div>
    </section>

    <aside class="card">
      <h2>Insights (live)</h2>
      <div class="badges" style="margin:8px 0 10px">
        <span class="chip high">High: <b id="cHigh">0</b></span>
        <span class="chip med">Medium: <b id="cMed">0</b></span>
        <span class="chip low">Low: <b id="cLow">0</b></span>
      </div>
      <div class="chart-wrap">
        <canvas id="mixChart" height="220"></canvas>
        <div id="hint" class="center-hint">Add a message to see insights</div>
      </div>
    </aside>
  </div>

  <section class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h2>Inbox</h2>
      <div class="filterbar">
        <select id="fPriority">
          <option value="All">Priority: All</option>
          <option>High</option><option>Medium</option><option>Low</option>
        </select>
        <select id="fCategory">
          <option value="All">Category: All</option>
          <option>Admissions</option><option>Visa & I-20</option><option>Scholarships</option>
          <option>Housing</option><option>Course Registration</option><option>Orientation</option><option>General</option>
        </select>
        <select id="fSent">
          <option value="All">Sentiment: All</option>
          <option>Negative</option><option>Neutral</option><option>Positive</option>
        </select>
      </div>
    </div>
    <div id="list" class="list"></div>
    <div id="empty" style="color:#5c6ea8" hidden>No items match the filters.</div>
  </section>

  <div class="pro-footer">
    Built by Sirivennela Bontha • Saint Louis University 2025
  </div>
</main>

<script>
/* -------- Mini classifier -------- */
const POS = ["thank you","great","happy","excited","awesome","love"];
const NEG = ["urgent","can't","cannot","error","problem","not working","failed","deadline","late","issue","stuck","worried"];
const CATS = [
  {name:"Visa & I-20", kws:["i-20","visa","sevis","immigration","embassy","interview"]},
  {name:"Admissions", kws:["admission","apply","application","deadline","offer"]},
  {name:"Scholarships", kws:["scholarship","financial aid","funding","waiver"]},
  {name:"Housing", kws:["housing","dorm","accommodation","apartment","residence"]},
  {name:"Course Registration", kws:["register","registration","enroll course","prereq","advisor"]},
  {name:"Orientation", kws:["orientation","arrival","airport","pickup","check-in"]},
  {name:"General", kws:[]}
];
function classify(text){
  const t = text.toLowerCase(); let score = 0;
  POS.forEach(w=>{ if(t.includes(w)) score+=1; });
  NEG.forEach(w=>{ if(t.includes(w)) score-=1.1; });
  const sentiment = score>0.5 ? "Positive" : score<-0.2 ? "Negative" : "Neutral";
  let category = "General";
  for(const c of CATS){ if(c.kws.some(k=>t.includes(k))){ category=c.name; break; } }
  const highKW=["urgent","deadline","today","tomorrow","i-20","visa","cannot login","can't login","payment failed","hold","blocked"];
  const lowKW =["thanks","thank you","feedback","just letting you know"];
  let priority = highKW.some(k=>t.includes(k)) ? "High" : lowKW.some(k=>t.includes(k)) ? "Low" : "Medium";
  return {category, priority, sentiment};
}

/* -------- Data + rendering -------- */
const rows=[]; const list=document.getElementById("list"); const empty=document.getElementById("empty");
const cHigh=document.getElementById("cHigh"); const cMed=document.getElementById("cMed"); const cLow=document.getElementById("cLow");
const fPriority=document.getElementById("fPriority"); const fCategory=document.getElementById("fCategory"); const fSent=document.getElementById("fSent");
const hint=document.getElementById("hint");

function rowView(r){
  const el=document.createElement("div"); el.className="row";
  const badge=r.priority==="High"?"high":r.priority==="Medium"?"med":"low";
  el.innerHTML=`
    <div>
      <div class="badges">
        <span class="chip ${badge}">${r.priority}</span>
        <span class="chip">📂 ${r.category}</span>
        <span class="chip">🧭 ${r.sentiment}</span>
      </div>
      <div style="margin-top:6px">${escapeHtml(r.text)}</div>
      <div style="margin-top:6px;font-size:.9rem;opacity:.75">${r.name||"Anonymous"} • ${r.email||"no-email"} • ${new Date(r.ts).toLocaleString()}</div>
    </div>
    <div class="meta">
      <button class="primary" style="background:#eef4ff;border:1px solid #cfe0ff" onclick="resolveRow(${r.id})">Mark resolved</button>
    </div>`;
  return el;
}
function escapeHtml(s){return s.replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));}
function resolveRow(id){ const i=rows.findIndex(r=>r.id===id); if(i>-1){ rows.splice(i,1); render(); } }

function render(){
  list.innerHTML="";
  const filtered=rows.filter(r =>
    (fPriority.value==="All" || r.priority===fPriority.value) &&
    (fCategory.value==="All" || r.category===fCategory.value) &&
    (fSent.value==="All" || r.sentiment===fSent.value)
  );
  empty.hidden = filtered.length!==0;
  filtered.forEach(r=>list.appendChild(rowView(r)));
  const hi=rows.filter(r=>r.priority==="High").length;
  const me=rows.filter(r=>r.priority==="Medium").length;
  const lo=rows.filter(r=>r.priority==="Low").length;
  cHigh.textContent=hi; cMed.textContent=me; cLow.textContent=lo;
  updateChart(hi,me,lo);
}

/* -------- Button handler (fix) -------- */
function handleAnalyze(){
  const text=document.getElementById("msg").value.trim();
  if(!text){ alert("Please enter a message."); return; }
  const name=document.getElementById("name").value.trim();
  const email=document.getElementById("email").value.trim();
  const {category,priority,sentiment}=classify(text);
  rows.unshift({id:Date.now(), text, name, email, category, priority, sentiment, ts:Date.now()});
  document.getElementById("msg").value="";
  render();
}
document.getElementById("analyzeBtn")?.addEventListener("click", handleAnalyze); /* redundancy */

/* -------- Chart (placeholder -> SLU colors) -------- */
const ctx=document.getElementById("mixChart").getContext("2d");
const chart=new Chart(ctx,{
  type:"doughnut",
  data:{labels:["High","Medium","Low"],
    datasets:[{data:[1,1,1],backgroundColor:["#eec9cf","#f2e8b8","#cdd9f5"],borderColor:"#FFFFFF",borderWidth:2,hoverOffset:8}]},
  options:{cutout:"60%",plugins:{legend:{position:"bottom",labels:{boxWidth:14,usePointStyle:true}}}}
});
function updateChart(hi,me,lo){
  const total=hi+me+lo;
  if(total===0){
    chart.data.datasets[0].data=[1,1,1];
    chart.data.datasets[0].backgroundColor=["#eec9cf","#f2e8b8","#cdd9f5"];
    hint.style.display="block";
  }else{
    chart.data.datasets[0].data=[hi,me,lo];
    chart.data.datasets[0].backgroundColor=["#C8102E","#C5A900","#003DA5"]; /* SLU */
    hint.style.display="none";
  }
  chart.update();
}

/* Start */
render();
</script>
</body>
</html>
